!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).ImagePanZoom={})}(this,function(t){"use strict";class i{container;content;options;scale;x;y;rotation;isPanning=!1;didMove=!1;startClientX=0;startClientY=0;startX=0;startY=0;velocityX=0;velocityY=0;velocityScale=0;lastMoveTime=0;lastClientX=0;lastClientY=0;lastScale=1;animationFrameId=null;DRAG_THRESHOLD=3;boundWheel;boundPointerDown;boundPointerMove;boundPointerUp;boundDoubleClick;constructor(t,i,s={}){this.container=t,this.content=i,this.options={minScale:s.minScale??.5,maxScale:s.maxScale??3,initialScale:s.initialScale??1,wheelZoomSpeed:s.wheelZoomSpeed??.0015,boundsPadding:s.boundsPadding??.1,friction:s.friction??.92,maxSpeed:s.maxSpeed??300,transition:s.transition??!1},this.scale=this.options.initialScale,this.x=0,this.y=0,this.rotation=0,this.lastScale=this.options.initialScale,this.boundWheel=this.onWheel.bind(this),this.boundPointerDown=this.onPointerDown.bind(this),this.boundPointerMove=this.onPointerMove.bind(this),this.boundPointerUp=this.onPointerUp.bind(this),this.boundDoubleClick=this.onDoubleClick.bind(this),this.init()}init(){this.content.style.touchAction="none",this.content.style.userSelect="none",this.options.transition&&(this.content.style.transition="transform 0.3s ease-out"),this.applyTransform(),this.attachEvents()}attachEvents(){this.container.addEventListener("wheel",this.boundWheel,{passive:!1}),this.content.addEventListener("pointerdown",this.boundPointerDown),this.content.addEventListener("dblclick",this.boundDoubleClick),window.addEventListener("pointermove",this.boundPointerMove),window.addEventListener("pointerup",this.boundPointerUp)}getSizes(){const t=this.container.getBoundingClientRect(),i=t.width,s=t.height,n=Math.min(i,s)*this.options.boundsPadding,e=this.content.offsetWidth,o=this.content.offsetHeight;return{contW:i,contH:s,pad:n,w:e*this.scale,h:o*this.scale}}clampPosition(t,i){const{contW:s,contH:n,pad:e,w:o,h:a}=this.getSizes(),h=o<=s,l=a<=n;let r,c,m,d;if(h)r=c=0;else{const t=s/2,i=o/2;c=i-t+e,r=-(i-t)-e}if(l)m=d=0;else{const t=n/2,i=a/2;d=i-t+e,m=-(i-t)-e}return{x:h?0:Math.min(c,Math.max(r,t)),y:l?0:Math.min(d,Math.max(m,i))}}applyTransform(){this.container.style.overflow="hidden",this.container.style.position||(this.container.style.position="relative"),this.container.style.minHeight="25vh",this.content.style.position="absolute",this.content.style.top="50%",this.content.style.left="50%",this.content.style.transformOrigin="50% 50%";const t=this.clampPosition(this.x,this.y);this.x=t.x,this.y=t.y,this.content.style.transform=`translate(-50%, -50%) translate(${this.x}px, ${this.y}px) rotate(${this.rotation}deg) scale(${this.scale})`}clampScale(t){return Math.min(this.options.maxScale,Math.max(this.options.minScale,t))}stopAnimation(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}zoomToPoint(t,i,s){const n=this.container.getBoundingClientRect(),e=this.scale,o=this.clampScale(e*s);if(o===e)return;const a=t-n.left,h=i-n.top,l=n.width/2,r=n.height/2,c=a-l-this.x,m=h-r-this.y,d=o/e,p=c*d,y=m*d;this.scale=o,this.x+=c-p,this.y+=m-y,this.applyTransform()}animateKinetic=()=>{if(Math.abs(this.velocityX)<.5&&Math.abs(this.velocityY)<.5&&Math.abs(this.velocityScale)<.001)return this.stopAnimation(),void this.applyTransform();this.x+=this.velocityX,this.y+=this.velocityY,this.scale+=this.velocityScale,this.scale=this.clampScale(this.scale),this.velocityX*=this.options.friction,this.velocityY*=this.options.friction,this.velocityScale*=this.options.friction,this.applyTransform(),this.animationFrameId=requestAnimationFrame(this.animateKinetic)};onWheel(t){t.preventDefault(),this.stopAnimation(),this.velocityX=0,this.velocityY=0,this.velocityScale=0;const i=1+-t.deltaY*this.options.wheelZoomSpeed;0!==i&&this.zoomToPoint(t.clientX,t.clientY,i)}onPointerDown(t){0===t.button&&(this.stopAnimation(),this.isPanning=!0,this.didMove=!1,this.startClientX=t.clientX,this.startClientY=t.clientY,this.startX=this.x,this.startY=this.y,this.lastClientX=t.clientX,this.lastClientY=t.clientY,this.lastScale=this.scale,this.lastMoveTime=Date.now(),this.velocityX=0,this.velocityY=0,this.velocityScale=0,this.content.setPointerCapture(t.pointerId))}onPointerMove(t){if(!this.isPanning)return;const i=t.clientX-this.startClientX,s=t.clientY-this.startClientY;if(!this.didMove&&Math.hypot(i,s)<this.DRAG_THRESHOLD)return;this.didMove=!0;const n=this.startX+i,e=this.startY+s;this.x=n,this.y=e;const o=Date.now(),a=o-this.lastMoveTime;if(a>0){const i=(t.clientX-this.lastClientX)/a*16,s=(t.clientY-this.lastClientY)/a*16,n=(this.scale-this.lastScale)/a*16;this.velocityX=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,i)),this.velocityY=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,s)),this.velocityScale=Math.max(-.01,Math.min(.01,n))}this.lastClientX=t.clientX,this.lastClientY=t.clientY,this.lastScale=this.scale,this.lastMoveTime=o,this.applyTransform()}onPointerUp(t){if(this.isPanning){this.isPanning=!1;try{this.content.releasePointerCapture(t.pointerId)}catch{}this.didMove&&(Math.abs(this.velocityX)>1||Math.abs(this.velocityY)>1||Math.abs(this.velocityScale)>.001)&&(this.animationFrameId=requestAnimationFrame(this.animateKinetic))}}onDoubleClick(t){this.stopAnimation();const i=this.container.getBoundingClientRect(),s=i.width/2,n=i.height/2,e=t.clientX-i.left,o=t.clientY-i.top,a=Math.min(1.5*this.scale,this.options.maxScale),h=a/this.scale,l=e-s-this.x,r=o-n-this.y;this.scale=a;const c=l*h,m=r*h;this.x+=l-c,this.y+=r-m,this.applyTransform()}reset(){this.stopAnimation(),this.scale=this.options.initialScale,this.x=0,this.y=0,this.rotation=0,this.velocityX=0,this.velocityY=0,this.velocityScale=0,this.options.transition?(this.content.style.transition="transform 0.3s ease-out",this.applyTransform(),setTimeout(()=>{this.content.style.transition="transform 0.3s ease-out"},300)):this.applyTransform()}rotate(t){this.rotation=(this.rotation+t)%360,this.options.transition?(this.content.style.transition="transform 0.5s ease-out",this.applyTransform(),setTimeout(()=>{this.content.style.transition="transform 0.3s ease-out"},50)):this.applyTransform()}getTransform(){return{scale:this.scale,x:this.x,y:this.y,rotation:this.rotation}}setTransform(t){void 0!==t.scale&&(this.scale=this.clampScale(t.scale)),void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.rotation&&(this.rotation=t.rotation),this.options.transition?(this.content.style.transition="transform 0.3s ease-out",this.applyTransform(),setTimeout(()=>{this.content.style.transition="transform 0.3s ease-out"},300)):this.applyTransform()}destroy(){this.stopAnimation(),this.container.removeEventListener("wheel",this.boundWheel),this.content.removeEventListener("pointerdown",this.boundPointerDown),this.content.removeEventListener("dblclick",this.boundDoubleClick),window.removeEventListener("pointermove",this.boundPointerMove),window.removeEventListener("pointerup",this.boundPointerUp),this.content.style.transform="",this.content.style.touchAction=""}}t.ImagePanZoom=i,t.createImagePanZoom=function(t,s,n){return new i(t,s,n)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=image-pan-zoom.umd.js.map
