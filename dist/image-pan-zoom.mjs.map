{"version":3,"file":"image-pan-zoom.mjs","sources":["../src/index.ts"],"sourcesContent":["/**\r\n * ImagePanZoom - A lightweight library for pan and zoom functionality\r\n * @version 1.0.0\r\n */\r\n\r\n/**\r\n * Options for configuring the ImagePanZoom behavior\r\n */\r\nexport interface ImagePanZoomOptions {\r\n  /**\r\n   * Minimum scale value (default: 0.5)\r\n   */\r\n  minScale?: number\r\n  /**\r\n   * Maximum scale value (default: 3)\r\n   */\r\n  maxScale?: number\r\n  /**\r\n   * Initial scale value (default: 1)\r\n   */\r\n  initialScale?: number\r\n  /**\r\n   * Speed of zoom via mouse wheel (default: 0.0015)\r\n   */\r\n  wheelZoomSpeed?: number\r\n  /**\r\n   * Padding for boundaries in percentage (default: 0.1)\r\n   */\r\n  boundsPadding?: number\r\n  /**\r\n   * Friction coefficient for kinetic motion (default: 0.92)\r\n   */\r\n  friction?: number\r\n  /**\r\n   * Maximum speed for kinetic motion (default: 300)\r\n   */\r\n  maxSpeed?: number\r\n  /**\r\n   * Enable smooth transitions (default: false)\r\n   */\r\n  transition?: boolean\r\n}\r\n\r\n/**\r\n * Represents the current transformation state\r\n */\r\nexport interface Transform {\r\n  /**\r\n   * Current scale value\r\n   */\r\n  scale: number\r\n  /**\r\n   * X offset position\r\n   */\r\n  x: number\r\n  /**\r\n   * Y offset position\r\n   */\r\n  y: number\r\n  /**\r\n   * Rotation angle in degrees\r\n   */\r\n  rotation: number\r\n}\r\n\r\nexport class ImagePanZoom {\r\n  private container: HTMLElement\r\n  private content: HTMLElement\r\n  private options: Required<ImagePanZoomOptions>\r\n\r\n  private scale: number\r\n  private x: number\r\n  private y: number\r\n  private rotation: number\r\n\r\n  private isPanning: boolean = false\r\n  private didMove: boolean = false\r\n  private startClientX: number = 0\r\n  private startClientY: number = 0\r\n  private startX: number = 0\r\n  private startY: number = 0\r\n\r\n  private velocityX: number = 0\r\n  private velocityY: number = 0\r\n  private velocityScale: number = 0\r\n  private lastMoveTime: number = 0\r\n  private lastClientX: number = 0\r\n  private lastClientY: number = 0\r\n  private lastScale: number = 1\r\n  private animationFrameId: number | null = null\r\n\r\n  private readonly DRAG_THRESHOLD = 3\r\n\r\n  private boundWheel: (e: WheelEvent) => void\r\n  private boundPointerDown: (e: PointerEvent) => void\r\n  private boundPointerMove: (e: PointerEvent) => void\r\n  private boundPointerUp: (e: PointerEvent) => void\r\n  private boundDoubleClick: (e: MouseEvent) => void\r\n\r\n  constructor(container: HTMLElement, content: HTMLElement, options: ImagePanZoomOptions = {}) {\r\n    this.container = container\r\n    this.content = content\r\n    this.options = {\r\n      minScale: options.minScale ?? 0.5,\r\n      maxScale: options.maxScale ?? 3,\r\n      initialScale: options.initialScale ?? 1,\r\n      wheelZoomSpeed: options.wheelZoomSpeed ?? 0.0015,\r\n      boundsPadding: options.boundsPadding ?? 0.1,\r\n      friction: options.friction ?? 0.92,\r\n      maxSpeed: options.maxSpeed ?? 300,\r\n      transition: options.transition ?? false,\r\n    }\r\n\r\n    this.scale = this.options.initialScale\r\n    this.x = 0\r\n    this.y = 0\r\n    this.rotation = 0\r\n    this.lastScale = this.options.initialScale\r\n\r\n    this.boundWheel = this.onWheel.bind(this)\r\n    this.boundPointerDown = this.onPointerDown.bind(this)\r\n    this.boundPointerMove = this.onPointerMove.bind(this)\r\n    this.boundPointerUp = this.onPointerUp.bind(this)\r\n    this.boundDoubleClick = this.onDoubleClick.bind(this)\r\n\r\n    this.init()\r\n  }\r\n\r\n /**\r\n  * Initializes the pan and zoom functionality.\r\n  * Sets touch-action and user-select CSS properties on the content element.\r\n  * If transition is enabled, sets the transition CSS property on the content element.\r\n  * Applies the initial transform to the content element.\r\n  * Attaches wheel, pointerdown, pointermove, and pointerup event listeners.\r\n  */\r\n  private init(): void {\r\n    this.content.style.touchAction = 'none';\r\n    this.content.style.userSelect = 'none';\r\n\r\n    if (this.options.transition) this.content.style.transition = 'transform 0.3s ease-out'\r\n\r\n    this.applyTransform()\r\n    this.attachEvents()\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.container.addEventListener('wheel', this.boundWheel, { passive: false })\r\n    this.content.addEventListener('pointerdown', this.boundPointerDown)\r\n    this.content.addEventListener('dblclick', this.boundDoubleClick)\r\n    window.addEventListener('pointermove', this.boundPointerMove)\r\n    window.addEventListener('pointerup', this.boundPointerUp)\r\n  }\r\n\r\n /**\r\n  * Calculate and return the sizes of container and content elements\r\n  * @returns Object containing container width/height, padding, and scaled content dimensions\r\n  */\r\n  private getSizes() {\r\n    const contRect = this.container.getBoundingClientRect()\r\n    const contW = contRect.width\r\n    const contH = contRect.height\r\n    const pad = Math.min(contW, contH) * this.options.boundsPadding\r\n\r\n    const rawW = this.content.offsetWidth\r\n    const rawH = this.content.offsetHeight\r\n    const w = rawW * this.scale\r\n    const h = rawH * this.scale\r\n\r\n    return { contW, contH, pad, w, h }\r\n  }\r\n\r\n  private clampPosition(nextX: number, nextY: number): { x: number; y: number } {\r\n    const { contW, contH, pad, w, h } = this.getSizes()\r\n\r\n    const fitsHorizontally = w <= contW\r\n    const fitsVertically = h <= contH\r\n\r\n    let minX: number, maxX: number, minY: number, maxY: number\r\n    if (fitsHorizontally) {\r\n      minX = maxX = 0\r\n    } else {\r\n      const halfContW = contW / 2\r\n      const halfW = w / 2\r\n      \r\n      maxX = halfW - halfContW + pad\r\n      minX = -(halfW - halfContW) - pad\r\n    }\r\n\r\n    if (fitsVertically) {\r\n      minY = maxY = 0\r\n    } else {\r\n      const halfContH = contH / 2\r\n      const halfH = h / 2\r\n      \r\n      maxY = halfH - halfContH + pad\r\n      minY = -(halfH - halfContH) - pad\r\n    }\r\n\r\n    const clampedX = fitsHorizontally ? 0 : Math.min(maxX, Math.max(minX, nextX))\r\n    const clampedY = fitsVertically ? 0 : Math.min(maxY, Math.max(minY, nextY))\r\n\r\n    return { x: clampedX, y: clampedY }\r\n  }\r\n\r\n  private applyTransform(): void {\r\n    this.container.style.overflow = 'hidden'\r\n    if (!this.container.style.position) {\r\n      this.container.style.position = 'relative'\r\n    }\r\n\r\n    this.container.style.minHeight = '25vh'\r\n    this.content.style.position = 'absolute'\r\n    this.content.style.top = '50%'\r\n    this.content.style.left = '50%'\r\n    this.content.style.transformOrigin = '50% 50%'\r\n\r\n    const clamped = this.clampPosition(this.x, this.y)\r\n    this.x = clamped.x\r\n    this.y = clamped.y\r\n\r\n    this.content.style.transform = `translate(-50%, -50%) translate(${this.x}px, ${this.y}px) rotate(${this.rotation}deg) scale(${this.scale})`\r\n  }\r\n\r\n  private clampScale(next: number): number {\r\n    return Math.min(this.options.maxScale, Math.max(this.options.minScale, next))\r\n  }\r\n\r\n  private stopAnimation(): void {\r\n    if (this.animationFrameId !== null) {\r\n      cancelAnimationFrame(this.animationFrameId)\r\n      this.animationFrameId = null\r\n    }\r\n  }\r\n\r\n  private zoomToPoint(clientX: number, clientY: number, deltaScale: number): void {\r\n    const rect = this.container.getBoundingClientRect()\r\n    const prevScale = this.scale\r\n    const nextScale = this.clampScale(prevScale * deltaScale)\r\n    \r\n    if (nextScale === prevScale) return\r\n\r\n    const cx = clientX - rect.left\r\n    const cy = clientY - rect.top\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    const localX = cx - centerX - this.x\r\n    const localY = cy - centerY - this.y\r\n\r\n    const k = nextScale / prevScale\r\n    const newLocalX = localX * k\r\n    const newLocalY = localY * k\r\n\r\n    this.scale = nextScale\r\n    this.x += localX - newLocalX\r\n    this.y += localY - newLocalY\r\n\r\n    this.applyTransform()\r\n  }\r\n\r\n  private animateKinetic = (): void => {\r\n    if (Math.abs(this.velocityX) < 0.5 && Math.abs(this.velocityY) < 0.5 && Math.abs(this.velocityScale) < 0.001) {\r\n      this.stopAnimation()\r\n      this.applyTransform()\r\n      return\r\n    }\r\n\r\n    this.x += this.velocityX\r\n    this.y += this.velocityY\r\n    this.scale += this.velocityScale\r\n\r\n    this.scale = this.clampScale(this.scale)\r\n\r\n    this.velocityX *= this.options.friction\r\n    this.velocityY *= this.options.friction\r\n    this.velocityScale *= this.options.friction\r\n\r\n    this.applyTransform()\r\n    this.animationFrameId = requestAnimationFrame(this.animateKinetic)\r\n  }\r\n\r\n  private onWheel(e: WheelEvent): void {\r\n    e.preventDefault()\r\n    this.stopAnimation()\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n\r\n    const delta = -e.deltaY * this.options.wheelZoomSpeed\r\n    const factor = 1 + delta\r\n    if (factor === 0) return\r\n    \r\n    this.zoomToPoint(e.clientX, e.clientY, factor)\r\n  }\r\n\r\n  private onPointerDown(e: PointerEvent): void {\r\n    if (e.button !== 0) return\r\n\r\n    this.stopAnimation()\r\n\r\n    this.isPanning = true\r\n    this.didMove = false\r\n    this.startClientX = e.clientX\r\n    this.startClientY = e.clientY\r\n    this.startX = this.x\r\n    this.startY = this.y\r\n\r\n    this.lastClientX = e.clientX\r\n    this.lastClientY = e.clientY\r\n    this.lastScale = this.scale\r\n    this.lastMoveTime = Date.now()\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n\r\n    this.content.setPointerCapture(e.pointerId)\r\n  }\r\n\r\n  private onPointerMove(e: PointerEvent): void {\r\n    if (!this.isPanning) return\r\n\r\n    const dx = e.clientX - this.startClientX\r\n    const dy = e.clientY - this.startClientY\r\n\r\n    if (!this.didMove && Math.hypot(dx, dy) < this.DRAG_THRESHOLD) return\r\n    this.didMove = true\r\n\r\n    const nextX = this.startX + dx\r\n    const nextY = this.startY + dy\r\n\r\n    this.x = nextX\r\n    this.y = nextY\r\n\r\n    const now = Date.now()\r\n    const dt = now - this.lastMoveTime\r\n    if (dt > 0) {\r\n      const vx = (e.clientX - this.lastClientX) / dt * 16\r\n      const vy = (e.clientY - this.lastClientY) / dt * 16\r\n      const scaleDiff = this.scale - this.lastScale\r\n      const scaleVelocity = scaleDiff / dt * 16\r\n\r\n      this.velocityX = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vx))\r\n      this.velocityY = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vy))\r\n      this.velocityScale = Math.max(-0.01, Math.min(0.01, scaleVelocity))\r\n    }\r\n\r\n    this.lastClientX = e.clientX\r\n    this.lastClientY = e.clientY\r\n    this.lastScale = this.scale\r\n    this.lastMoveTime = now\r\n\r\n    this.applyTransform()\r\n  }\r\n\r\n  private onPointerUp(e: PointerEvent): void {\r\n    if (!this.isPanning) return\r\n    this.isPanning = false\r\n\r\n    try {\r\n      this.content.releasePointerCapture(e.pointerId)\r\n    } catch {}\r\n\r\n    if (this.didMove && (Math.abs(this.velocityX) > 1 || Math.abs(this.velocityY) > 1 || Math.abs(this.velocityScale) > 0.001)) {\r\n      this.animationFrameId = requestAnimationFrame(this.animateKinetic)\r\n    }\r\n  }\r\n\r\n  private onDoubleClick(e: MouseEvent): void {\r\n    this.stopAnimation()\r\n    const rect = this.container.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n    const clickX = e.clientX - rect.left\r\n    const clickY = e.clientY - rect.top\r\n\r\n    const targetScale = Math.min(this.scale * 1.5, this.options.maxScale)\r\n    const scaleRatio = targetScale / this.scale\r\n\r\n    const localX = clickX - centerX - this.x\r\n    const localY = clickY - centerY - this.y\r\n    this.scale = targetScale\r\n\r\n    const newLocalX = localX * scaleRatio\r\n    const newLocalY = localY * scaleRatio\r\n    this.x += localX - newLocalX\r\n    this.y += localY - newLocalY\r\n    this.applyTransform()\r\n  }\r\n\r\n  /**\r\n   * Reset transform to initial state\r\n   */\r\n  public reset(): void {\r\n    this.stopAnimation()\r\n    this.scale = this.options.initialScale\r\n    this.x = 0\r\n    this.y = 0\r\n    this.rotation = 0\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n    \r\n    if (this.options.transition) {\r\n      this.content.style.transition = 'transform 0.3s ease-out'\r\n      this.applyTransform()\r\n      setTimeout(() => {\r\n        this.content.style.transition = 'transform 0.3s ease-out'\r\n      }, 300)\r\n    } else {\r\n      this.applyTransform()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rotate content by specified degrees\r\n   * @param deg - Degrees to rotate\r\n   */\r\n  public rotate(deg: number): void {\r\n    this.rotation = (this.rotation + deg) % 360\r\n    if (this.options.transition) {\r\n      this.content.style.transition = 'transform 0.5s ease-out'\r\n      this.applyTransform()\r\n\r\n      setTimeout(() => {\r\n        this.content.style.transition = 'transform 0.3s ease-out'\r\n      }, 50)\r\n    } else {\r\n      this.applyTransform()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current transform state\r\n   * @returns Current transform object with scale, x, y, and rotation values\r\n   */\r\n  public getTransform(): Transform {\r\n    return {\r\n      scale: this.scale,\r\n      x: this.x,\r\n      y: this.y,\r\n      rotation: this.rotation,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set transform state\r\n   * @param transform - Transform object with scale, x, y, and/or rotation values to set\r\n   */\r\n  public setTransform(transform: Partial<Transform>): void {\r\n    if (transform.scale !== undefined) {\r\n      this.scale = this.clampScale(transform.scale)\r\n    }\r\n    if (transform.x !== undefined) {\r\n      this.x = transform.x\r\n    }\r\n    if (transform.y !== undefined) {\r\n      this.y = transform.y\r\n    }\r\n    if (transform.rotation !== undefined) {\r\n      this.rotation = transform.rotation\r\n    }\r\n    \r\n    if (this.options.transition) {\r\n      this.content.style.transition = 'transform 0.3s ease-out'\r\n      this.applyTransform()\r\n      setTimeout(() => {\r\n        this.content.style.transition = 'transform 0.3s ease-out'\r\n      }, 300)\r\n    } else {\r\n      this.applyTransform()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy instance and remove all event listeners\r\n   */\r\n  public destroy(): void {\r\n    this.stopAnimation()\r\n    this.container.removeEventListener('wheel', this.boundWheel)\r\n    this.content.removeEventListener('pointerdown', this.boundPointerDown)\r\n    this.content.removeEventListener('dblclick', this.boundDoubleClick)\r\n    window.removeEventListener('pointermove', this.boundPointerMove)\r\n    window.removeEventListener('pointerup', this.boundPointerUp)\r\n    \r\n    this.content.style.transform = ''\r\n    this.content.style.touchAction = ''\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Factory function to create a new ImagePanZoom instance\r\n * @param container - Container element to hold the content\r\n * @param content - Content element to apply pan and zoom to\r\n * @param options - Options to configure the behavior\r\n * @returns A new ImagePanZoom instance\r\n */\r\nexport function createImagePanZoom(\r\n  container: HTMLElement,\r\n  content: HTMLElement,\r\n  options?: ImagePanZoomOptions\r\n): ImagePanZoom {\r\n  return new ImagePanZoom(container, content, options)\r\n}"],"names":["ImagePanZoom","container","content","options","scale","x","y","rotation","isPanning","didMove","startClientX","startClientY","startX","startY","velocityX","velocityY","velocityScale","lastMoveTime","lastClientX","lastClientY","lastScale","animationFrameId","DRAG_THRESHOLD","boundWheel","boundPointerDown","boundPointerMove","boundPointerUp","boundDoubleClick","constructor","this","minScale","maxScale","initialScale","wheelZoomSpeed","boundsPadding","friction","maxSpeed","transition","onWheel","bind","onPointerDown","onPointerMove","onPointerUp","onDoubleClick","init","style","touchAction","userSelect","applyTransform","attachEvents","addEventListener","passive","window","getSizes","contRect","getBoundingClientRect","contW","width","contH","height","pad","Math","min","rawW","offsetWidth","rawH","offsetHeight","w","h","clampPosition","nextX","nextY","fitsHorizontally","fitsVertically","minX","maxX","minY","maxY","halfContW","halfW","halfContH","halfH","max","overflow","position","minHeight","top","left","transformOrigin","clamped","transform","clampScale","next","stopAnimation","cancelAnimationFrame","zoomToPoint","clientX","clientY","deltaScale","rect","prevScale","nextScale","cx","cy","centerX","centerY","localX","localY","k","newLocalX","newLocalY","animateKinetic","abs","requestAnimationFrame","e","preventDefault","factor","deltaY","button","Date","now","setPointerCapture","pointerId","dx","dy","hypot","dt","vx","vy","scaleVelocity","releasePointerCapture","clickX","clickY","targetScale","scaleRatio","reset","setTimeout","rotate","deg","getTransform","setTransform","destroy","removeEventListener","createImagePanZoom"],"mappings":"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"}